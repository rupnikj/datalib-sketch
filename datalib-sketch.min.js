!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(e.dl||(e.dl={})).sketch=t()}}(function(){return function t(e,i,n){function r(o,h){if(!i[o]){if(!e[o]){var u="function"==typeof require&&require;if(!h&&u)return u(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var _=i[o]={exports:{}};e[o][0].call(_.exports,function(t){var i=e[o][1][t];return r(i?i:t)},_,_.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){function n(t,e){t=t||h,e=e||u;var i;"number"!=typeof t&&(i=t,t=32*i.length);var n,r=Math.ceil(t/32),a=-1;if(this._w=t=32*r,this._d=e,o){if(n=this._buckets=new Int32Array(r),i)for(;++a<r;)n[a]=i[a]}else if(n=this._buckets=[],i)for(;++a<r;)n[a]=i[a];else for(;++a<r;)n[a]=0;s.init.call(this)}function r(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}var s=t("./hash"),o="undefined"!=typeof ArrayBuffer,h=8388608,u=5;n.create=function(t,e){var i=-t*Math.log(e)/(Math.LN2*Math.LN2),r=i/t*Math.LN2;return new n(~~i,~~r)},n["import"]=function(t){return new n(t.bits,t.depth)};var a=n.prototype;a.locations=s.locations,a.add=function(t){for(var e=this.locations(t+""),i=-1,n=this._d,r=this._buckets;++i<n;)r[Math.floor(e[i]/32)]|=1<<e[i]%32},a.query=function(t){for(var e,i=this.locations(t+""),n=-1,r=this._d,s=this._buckets;++n<r;)if(e=i[n],0===(s[Math.floor(e/32)]&1<<e%32))return!1;return!0},a.size=function(){var t,e,i=this._buckets,n=0;for(t=0,e=i.length;e>t;++t)n+=r(i[t]);return-this._w*Math.log(1-n/this._w)/this._d},a.union=function(t){if(t._w!==this._w)throw"Filter widths do not match.";if(t._d!==this._d)throw"Filter depths do not match.";var e,i=this._buckets,r=t._buckets,s=i.length,h=o?new Int32Array(s):Array(s);for(e=0;s>e;++e)h[e]=i[e]|r[e];return new n(h,this._d)},a._estimate=function(t,e){if(t._w!==this._w)throw"Filter widths do not match.";if(t._d!==this._d)throw"Filter depths do not match.";var i,n,s,o,h=this._buckets,u=t._buckets,a=h.length;for(o=i=n=s=0;a>o;++o)i+=r(h[o]),n+=r(u[o]),s+=r(h[o]|u[o]);return i=Math.log(1-i/this._w),n=Math.log(1-n/this._w),s=Math.log(1-s/this._w),e(i,n,s)},a.jaccard=function(t){return this._estimate(t,function(t,e,i){return i?(t+e)/i-1:0})},a.cover=function(t){return this._estimate(t,function(t,e,i){var n=Math.max(t,e);return n?(t+e-i)/n:0})},a["export"]=function(){return{depth:this._d,bits:[].slice.call(this._buckets)}},e.exports=n},{"./hash":4}],2:[function(t,e,i){function n(t,e,i){o.call(this,t,e,i),this._q=Array(e)}function r(t){t.sort(s);var e=t.length,i=~~(e/2);return e%2?t[i]:.5*(t[i-1]+t[i])}function s(t,e){return t-e}var o=t("./count-min");n.create=o.create,n["import"]=o["import"];var h=n.prototype=Object.create(o.prototype);h.query=function(t){var e,i,n,s=this.locations(t+""),o=this._table,h=this._q,u=this._w,a=this._d,_=this._num,c=1/(u-1),f=+(1/0);for(i=0,n=0;a>i;++i,n+=u)e=o[n+s[i]],f>e&&(f=e),e-=(_-e)*c,h[i]=e;return(e=r(h))<0?0:e>f?f:e},h.dot=function(t){if(this._w!==t._w)throw"Sketch widths do not match.";if(this._d!==t._d)throw"Sketch depths do not match.";var e=this._table,i=t._table,n=this._q,s=this._w,o=this._num,h=this._d*s,u=(s-1)/s,a=1/(s-1),_=0,c=0;do _+=(e[c]-(o-e[c])*a)*(i[c]-(o-i[c])*a),++c%s===0&&(n[c/s-1]=u*_,_=0);while(h>c);return(_=r(n))<0?0:_},e.exports=n},{"./count-min":3}],3:[function(t,e,i){function n(t,e,i){t=t||o,e=e||h;var n,u,a,_=-1;if("number"!=typeof t&&(n=t,t=n.length/e),this._w=t,this._d=e,this._num=i||0,a=t*e,s){if(u=this._table=new Int32Array(a),n)for(;++_<a;)u[_]=n[_]}else{if(u=this._table=Array(a),n)for(;++_<a;)u[_]=n[_];for(;++_<a;)u[_]=0}r.init.call(this)}var r=t("./hash"),s="undefined"!=typeof ArrayBuffer,o=27191,h=9;n.create=function(t,e,i){e=t?e?e/t:1/t:.001,i=i||.001;var n=Math.ceil(Math.E/e),r=Math.ceil(-Math.log(i));return new this(n,r)},n["import"]=function(t){return new this(t.counts,t.depth,t.num)};var u=n.prototype;u.locations=r.locations,u.add=function(t){var e,i,n=this.locations(t+""),r=this._table,s=this._w,o=this._d;for(e=0,i=0;o>e;++e,i+=s)r[i+n[e]]+=1;this._num+=1},u.query=function(t){var e,i,n,r=+(1/0),s=this.locations(t+""),o=this._table,h=this._w,u=this._d;for(e=0,i=0;u>e;++e,i+=h)n=o[i+s[e]],r>n&&(r=n);return r},u.dot=function(t){if(this._w!==t._w)throw"Sketch widths do not match.";if(this._d!==t._d)throw"Sketch depths do not match.";var e=this._table,i=t._table,n=this._w,r=this._d*n,s=+(1/0),o=0,h=0;do o+=e[h]*i[h],++h%n===0&&(s>o&&(s=o),o=0);while(r>h);return s},u["export"]=function(){return{num:this._num,depth:this._d,counts:[].slice.call(this._table)}},e.exports=n},{"./hash":4}],4:[function(t,e,i){function n(t){for(var e,i,n=t.length,r=2166136261,s=-1;++s<n;)e=t.charCodeAt(s),(i=4278190080&e)&&(r^=i>>24,r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)),(i=16711680&e)&&(r^=i>>16,r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)),(i=65280&e)&&(r^=i>>8,r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24)),r^=255&e,r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return r+=r<<13,r^=r>>7,r+=r<<3,r^=r>>17,r+=r<<5,4294967295&r}function r(t){return t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t+=t<<13,t^=t>>7,t+=t<<3,t^=t>>17,t+=t<<5,4294967295&t}var s="undefined"!=typeof ArrayBuffer;e.exports.init=function(){var t=this._d,e=this._w;if(s){var i=1<<Math.ceil(Math.log(Math.ceil(Math.log(e)/Math.LN2/8))/Math.LN2),n=1===i?Uint8Array:2===i?Uint16Array:Uint32Array,r=new ArrayBuffer(i*t);this._locations=new n(r)}else this._locations=[]},e.exports.locations=function(t){for(var e=this._d,i=this._w,s=this._locations,o=n(t),h=r(o),u=-1,a=o%i;++u<e;)s[u]=0>a?a+i:a,a=(a+h)%i;return s},e.exports.fnv_1a=n,e.exports.fnv_1a_b=r},{}],5:[function(t,e,i){e.exports={Bloom:t("./bloom"),CountMin:t("./count-min"),CountMeanMin:t("./count-mean-min"),NGram:t("./ngram"),StreamSummary:t("./stream-summary"),TDigest:t("./t-digest")}},{"./bloom":1,"./count-mean-min":2,"./count-min":3,"./ngram":6,"./stream-summary":7,"./t-digest":8}],6:[function(t,e,i){function n(t,e,i){this._n=null==t?2:t,this._case=!!e,this._map=i||{},this._norm=null}function r(t,e,i,n){var r,s,o=t.length-e+1;for(s=0;o>s;++s)r=t.substr(s,e),i||(r=r.toLowerCase()),n[r]=n[r]?n[r]+1:1}n["import"]=function(t){return new n(t.n,t["case"],t.counts)};var s=n.prototype;s.add=function(t){null!=t&&""!==t&&(this._norm=null,r(String(t),this._n,this._case,this._map))},s.query=function(t){return this._map[this._case?t:t.toLowerCase()]||0},s.size=function(){return Object.keys(this._map).length},s.norm=function(){if(null==this._norm){var t,e=this._map,i=0;for(t in e)i+=e[t]*e[t];this._norm=Math.sqrt(i)}return this._norm},s.dot=function(t){var e,i=this._map,n=t._map,r=0;for(e in i)r+=i[e]*(n[e]||0);return r},s.cosine=function(t){var e=this.norm(),i=t.norm();return e&&i?this.dot(t)/(e*i):0},s["export"]=function(){return{n:this._n,"case":this._case,counts:this._map}},e.exports=n},{}],7:[function(t,e,i){function n(t){this._w=t||u,this._values={},this._buckets={count:-1},this._buckets.next=this._buckets,this._buckets.prev=this._buckets,this._size=0}function r(t){var e={count:t};return e.next=e,e.prev=e,e.list={},e.list.prev=e.list,e.list.next=e.list,e}function s(t,e){return{bucket:e,value:t,count:0,error:0}}function o(t,e){var i=t.next;return e.next=i,e.prev=t,t.next=e,i.prev=e,e}function h(t){var e=t.next,i=t.prev;i.next=e,e.prev=i}var u=100;n["import"]=function(t){var e,i,h,u,a,_,c,f=new n(t.w),l=f._buckets;for(e=0,i=t.buckets.length;i>e;++e)for(h=t.buckets[e],u=o(l.prev,r(h[0])),a=1,_=h.length;_>a;a+=2)c=o(u.list.prev,s(h[a],u)),c.count=u.count,c.error=h[a+1],f._size+=1;return f};var a=n.prototype;a.add=function(t,e){e=e||1;var i,n=this._values[t];null==n&&(this._size<this._w?(i=o(this._buckets,r(0)),n=o(i.list,s(t,i)),this._size+=1):(i=this._buckets.next,n=i.list.next,delete this._values[n.value],n.value=t,n.error=i.count),this._values[t]=n),this._increment(n,e)},a._increment=function(t,e){var i=this._buckets,n=t.bucket,s=n,u=s.next;for(h(t),t.count+=e;u!==i;){if(t.count===u.count){o(u.list,t);break}t.count>u.count?(s=u,u=s.next):u=i}u===i&&(u=r(t.count),o(u.list,t),o(s,u)),t.bucket=u,n.list.next===n.list&&h(n)},a.query=function(t){var e=this._values[t];return e?e.count:0},a.error=function(t){var e=this._values[t];return e?e.error:-1},a.values=function(t){return this.collect(t,function(t){return t.value})},a.counts=function(t){return this.collect(t,function(t){return t.count})},a.errors=function(t){return this.collect(t,function(t){return t.error})},a.collect=function(t,e){if(0===t)return[];(null==t||0>t)&&(t=this._size);var i,n,r,s=Array(t),o=this._buckets,h=0;for(i=o.prev;i!==o;i=i.prev)for(n=i.list,r=n.prev;r!==n;r=r.prev)if(s[h++]=e(r),h===t)return s;return s},a["export"]=function(){var t,e,i,n=this._buckets,r=[];for(t=n.next;t!==n;t=t.next){for(i=[t.count],e=t.list.next;e!==t.list;e=e.next)i.push(e.value,e.error);r.push(i)}return{w:this._w,buckets:r}},e.exports=n},{}],8:[function(t,e,i){function n(t){var e,i,n=t||a;n=20>n?20:n>1e3?1e3:n,e=~~(7.5+.37*n-2e-4*n*n),i=Math.ceil(Math.PI*n),this._cf=n,this._totalSum=0,this._last=0,this._weight=r(i),this._mean=r(i),this._min=Number.MAX_VALUE,this._max=-Number.MAX_VALUE,this._unmergedSum=0,this._mergeWeight=r(i),this._mergeMean=r(i),this._tempLast=0,this._tempWeight=r(e),this._tempMean=r(e),this._order=[]}function r(t){return h?new Float64Array(t):Array(t)}function s(t,e){return t*(Math.asin(2*e-1)+Math.PI/2)/Math.PI}function o(t,e,i){return(t-e)/(i-e)}var h="undefined"!=typeof ArrayBuffer,u=1e-300,a=100;n["import"]=function(t){var e=new n(t.compress),i=0;e._min=t.min,e._max=t.max,e._last=t.mean.length-1;for(var r=0,s=t.mean.length;s>r;++r)e._mean[r]=t.mean[r],i+=e._weight[r]=t.weight[r];return e._totalSum=i,e};var _=n.prototype;_.add=function(t,e){if(null!=t&&t===t){e=e||1,this._tempLast>=this._tempWeight.length&&this._mergeValues();var i=this._tempLast++;this._tempWeight[i]=e,this._tempMean[i]=t,this._unmergedSum+=e}},_._mergeValues=function(){if(0!==this._unmergedSum){var t,e,i,n,r=this._tempWeight,s=this._tempMean,o=this._tempLast,h=this._weight,u=this._mean,a=0,_=this._order,c=0;for(_.length=o,e=0;o>e;++e)_[e]=e;for(_.sort(function(t,e){return s[t]-s[e]}),this._totalSum>0&&(a=h[this._last]>0?this._last+1:this._last),this._last=0,this._totalSum+=this._unmergedSum,this._unmergedSum=0,e=i=n=0;o>e&&a>i;)t=_[e],s[t]<=u[i]?(c+=r[t],n=this._mergeCentroid(c,n,r[t],s[t]),e++):(c+=h[i],n=this._mergeCentroid(c,n,h[i],u[i]),i++);for(;o>e;++e)t=_[e],c+=r[t],n=this._mergeCentroid(c,n,r[t],s[t]);for(;a>i;++i)c+=h[i],n=this._mergeCentroid(c,n,h[i],u[i]);for(this._tempLast=0,this._weight=this._mergeWeight,this._mergeWeight=h,e=0,a=h.length;a>e;++e)h[e]=0;this._mean=this._mergeMean,this._mergeMean=u,this._weight[a=this._last]<=0&&--a,this._min=Math.min(this._min,this._mean[0]),this._max=Math.max(this._max,this._mean[a])}},_._mergeCentroid=function(t,e,i,n){var r=this._mergeWeight,o=this._mergeMean,h=this._last,u=s(this._cf,t/this._totalSum);return 1>=u-e||0===r[h]?(r[h]+=i,o[h]=o[h]+(n-o[h])*i/r[h]):(this._last=++h,o[h]=n,r[h]=i,e=s(this._cf,(t-i)/this._totalSum)),e},_.size=function(){return this._totalSum+this._unmergedSum},_.quantile=function(t){this._mergeValues(),t*=this._totalSum;var e,i,n,r,s,o=this._weight,h=this._mean,u=this._last,a=this._max,_=h[0],c=o[0],f=this._min,l=0;if(0===u)return 0===o[u]?NaN:h[0];for(o[u]>0&&++u,s=1;u>s;++s){if(e=h[s],i=o[s],n=(i*_+c*e)/(c+i),l+c>t)return r=(t-l)/c,f*(1-r)+n*r;l+=c,_=e,c=i,f=n}return n=a,l+c>t?(r=(t-l)/c,f*(1-r)+n*r):a},_.cdf=function(t){this._mergeValues();var e,i,n,r,s=this._totalSum,h=this._weight,a=this._mean,_=this._last,c=this._min,f=this._max,l=c,m=0,d=0,p=0;if(0===_)return 0===h[_]?NaN:c>t?0:t>f?1:u>f-c?.5:o(t,c,f);for(h[_]>0&&++_,r=0;_>r;++r){if(e=a[r],i=h[r],n=(e-l)*m/(m+i),l+n>t)return t=(d+m*o(t,l-p,l+n))/s,t>0?t:0;d+=m,p=e-(l+n),l=e,m=i}return n=f-l,l+n>t?(d+m*o(t,l-p,l+n))/s:1},_.union=function(t){var e=n["import"](this["export"]());t._mergeValues();for(var i=0,r=t._last;r>i;++i)e.add(t._mean[i],t._weight[i]);return e},_["export"]=function(){return this._mergeValues(),{compress:this._cf,min:this._min,max:this._max,mean:[].slice.call(this._mean,0,this._last+1),weight:[].slice.call(this._weight,0,this._last+1)}},e.exports=n},{}]},{},[5])(5)});