!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(n.dl||(n.dl={})).sketch=t()}}(function(){return function t(n,e,i){function r(o,h){if(!e[o]){if(!n[o]){var u="function"==typeof require&&require;if(!h&&u)return u(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var _=e[o]={exports:{}};n[o][0].call(_.exports,function(t){var e=n[o][1][t];return r(e?e:t)},_,_.exports,t,n,e,i)}return e[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,n,e){function i(t){return new Float64Array(t)}function r(t){return new Int32Array(t)}function s(t){for(var n=Array(t),e=0;e<t;++e)n[e]=0;return n}var o="undefined"!=typeof ArrayBuffer;n.exports={floats:o?i:s,ints:o?r:s}},{}],2:[function(t,n,e){function i(t,n){t=t||h,n=n||u;var e;"number"!=typeof t&&(e=t,t=32*e.length);var i,r=Math.ceil(t/32),a=-1;if(this._w=t=32*r,this._d=n,i=this._buckets=s.ints(r),e)for(;++a<r;)i[a]=e[a];o.init.call(this)}function r(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}var s=t("./arrays"),o=t("./hash"),h=8388608,u=5;i.create=function(t,n){var e=-t*Math.log(n)/(Math.LN2*Math.LN2),r=e/t*Math.LN2;return new i(~~e,~~r)},i.import=function(t){return new i(t.bits,t.depth)};var a=i.prototype;a.locations=o.locations,a.add=function(t){for(var n=this.locations(t+""),e=-1,i=this._d,r=this._buckets;++e<i;)r[Math.floor(n[e]/32)]|=1<<n[e]%32},a.query=function(t){for(var n,e=this.locations(t+""),i=-1,r=this._d,s=this._buckets;++i<r;)if(n=e[i],0===(s[Math.floor(n/32)]&1<<n%32))return!1;return!0},a.size=function(){var t,n,e=this._buckets,i=0;for(t=0,n=e.length;t<n;++t)i+=r(e[t]);return-this._w*Math.log(1-i/this._w)/this._d},a.union=function(t){if(t._w!==this._w)throw"Filter widths do not match.";if(t._d!==this._d)throw"Filter depths do not match.";var n,e=this._buckets,r=t._buckets,o=e.length,h=s.ints(o);for(n=0;n<o;++n)h[n]=e[n]|r[n];return new i(h,this._d)},a._estimate=function(t,n){if(t._w!==this._w)throw"Filter widths do not match.";if(t._d!==this._d)throw"Filter depths do not match.";var e,i,s,o,h=this._buckets,u=t._buckets,a=h.length;for(o=e=i=s=0;o<a;++o)e+=r(h[o]),i+=r(u[o]),s+=r(h[o]|u[o]);return e=Math.log(1-e/this._w),i=Math.log(1-i/this._w),s=Math.log(1-s/this._w),n(e,i,s)},a.jaccard=function(t){return this._estimate(t,function(t,n,e){return e?(t+n)/e-1:0})},a.cover=function(t){return this._estimate(t,function(t,n,e){var i=Math.max(t,n);return i?(t+n-e)/i:0})},a.export=function(){return{depth:this._d,bits:[].slice.call(this._buckets)}},n.exports=i},{"./arrays":1,"./hash":5}],3:[function(t,n,e){function i(t,n,e){o.call(this,t,n,e),this._q=Array(n)}function r(t){t.sort(s);var n=t.length,e=~~(n/2);return n%2?t[e]:.5*(t[e-1]+t[e])}function s(t,n){return t-n}var o=t("./count-min");i.create=o.create,i.import=o.import;var h=i.prototype=Object.create(o.prototype);h.query=function(t){var n,e,i,s=this.locations(t+""),o=this._table,h=this._q,u=this._w,a=this._d,_=this._num,c=1/(u-1),f=+(1/0);for(e=0,i=0;e<a;++e,i+=u)n=o[i+s[e]],n<f&&(f=n),n-=(_-n)*c,h[e]=n;return(n=r(h))<0?0:n>f?f:n},h.dot=function(t){if(this._w!==t._w)throw"Sketch widths do not match.";if(this._d!==t._d)throw"Sketch depths do not match.";var n=this._table,e=t._table,i=this._q,s=this._w,o=this._num,h=this._d*s,u=(s-1)/s,a=1/(s-1),_=0,c=0;do _+=(n[c]-(o-n[c])*a)*(e[c]-(o-e[c])*a),++c%s===0&&(i[c/s-1]=u*_,_=0);while(c<h);return(_=r(i))<0?0:_},n.exports=i},{"./count-min":4}],4:[function(t,n,e){function i(t,n,e){t=t||o,n=n||h;var i,u,a,_=-1;if("number"!=typeof t&&(i=t,t=i.length/n),this._w=t,this._d=n,this._num=e||0,a=t*n,u=this._table=r.ints(a),i)for(;++_<a;)u[_]=i[_];s.init.call(this)}var r=t("./arrays"),s=t("./hash"),o=27191,h=9;i.create=function(t,n,e){n=t?n?n/t:1/t:.001,e=e||.001;var i=Math.ceil(Math.E/n),r=Math.ceil(-Math.log(e));return new this(i,r)},i.import=function(t){return new this(t.counts,t.depth,t.num)};var u=i.prototype;u.locations=s.locations,u.add=function(t){var n,e,i=this.locations(t+""),r=this._table,s=this._w,o=this._d;for(n=0,e=0;n<o;++n,e+=s)r[e+i[n]]+=1;this._num+=1},u.query=function(t){var n,e,i,r=+(1/0),s=this.locations(t+""),o=this._table,h=this._w,u=this._d;for(n=0,e=0;n<u;++n,e+=h)i=o[e+s[n]],i<r&&(r=i);return r},u.dot=function(t){if(this._w!==t._w)throw"Sketch widths do not match.";if(this._d!==t._d)throw"Sketch depths do not match.";var n=this._table,e=t._table,i=this._w,r=this._d*i,s=+(1/0),o=0,h=0;do o+=n[h]*e[h],++h%i===0&&(o<s&&(s=o),o=0);while(h<r);return s},u.export=function(){return{num:this._num,depth:this._d,counts:[].slice.call(this._table)}},n.exports=i},{"./arrays":1,"./hash":5}],5:[function(t,n,e){function i(t){for(var n=2166136261,e=0,i=t.length;e<i;++e){var s=t.charCodeAt(e),h=65280&s;h&&(n=r(n^h>>8)),n=r(n^255&s)}return o(n)}function r(t){return t+(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}function s(t){return o(r(t))}function o(t){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,4294967295&t}var h=t("./arrays");n.exports.init=function(){this._locations=h.ints(this._d)},n.exports.locations=function(t){for(var n=this._d,e=this._w,r=this._locations,o=i(t),h=s(o),u=-1,a=o%e;++u<n;)r[u]=a<0?a+e:a,a=(a+h)%e;return r},n.exports.fnv_1a=i,n.exports.fnv_1a_b=s},{"./arrays":1}],6:[function(t,n,e){n.exports={Bloom:t("./bloom"),CountMin:t("./count-min"),CountMeanMin:t("./count-mean-min"),NGram:t("./ngram"),StreamSummary:t("./stream-summary"),TDigest:t("./t-digest")}},{"./bloom":2,"./count-mean-min":3,"./count-min":4,"./ngram":7,"./stream-summary":8,"./t-digest":9}],7:[function(t,n,e){function i(t,n,e){this._n=null==t?2:t,this._case=!!n,this._map=e||{},this._norm=null}function r(t,n,e,i){var r,s,o=t.length-n+1;for(s=0;s<o;++s)r=t.substr(s,n),e||(r=r.toLowerCase()),i[r]=i[r]?i[r]+1:1}i.import=function(t){return new i(t.n,t.case,t.counts)};var s=i.prototype;s.add=function(t){null!=t&&""!==t&&(this._norm=null,r(String(t),this._n,this._case,this._map))},s.query=function(t){return this._map[this._case?t:t.toLowerCase()]||0},s.size=function(){return Object.keys(this._map).length},s.norm=function(){if(null==this._norm){var t,n=this._map,e=0;for(t in n)e+=n[t]*n[t];this._norm=Math.sqrt(e)}return this._norm},s.dot=function(t){var n,e=this._map,i=t._map,r=0;for(n in e)r+=e[n]*(i[n]||0);return r},s.cosine=function(t){var n=this.norm(),e=t.norm();return n&&e?this.dot(t)/(n*e):0},s.export=function(){return{n:this._n,case:this._case,counts:this._map}},n.exports=i},{}],8:[function(t,n,e){function i(t){this._w=t||u,this._values={},this._buckets={count:-1},this._buckets.next=this._buckets,this._buckets.prev=this._buckets,this._size=0}function r(t){var n={count:t};return n.next=n,n.prev=n,n.list={},n.list.prev=n.list,n.list.next=n.list,n}function s(t,n){return{bucket:n,value:t,count:0,error:0}}function o(t,n){var e=t.next;return n.next=e,n.prev=t,t.next=n,e.prev=n,n}function h(t){var n=t.next,e=t.prev;e.next=n,n.prev=e}var u=100;i.import=function(t){var n,e,h,u,a,_,c,f=new i(t.w),l=f._buckets;for(n=0,e=t.buckets.length;n<e;++n)for(h=t.buckets[n],u=o(l.prev,r(h[0])),a=1,_=h.length;a<_;a+=2)c=o(u.list.prev,s(h[a],u)),c.count=u.count,c.error=h[a+1],f._size+=1;return f};var a=i.prototype;a.add=function(t,n){n=n||1;var e,i=this._values[t];null==i&&(this._size<this._w?(e=o(this._buckets,r(0)),i=o(e.list,s(t,e)),this._size+=1):(e=this._buckets.next,i=e.list.next,delete this._values[i.value],i.value=t,i.error=e.count),this._values[t]=i),this._increment(i,n)},a._increment=function(t,n){var e=this._buckets,i=t.bucket,s=i,u=s.next;for(h(t),t.count+=n;u!==e;){if(t.count===u.count){o(u.list,t);break}t.count>u.count?(s=u,u=s.next):u=e}u===e&&(u=r(t.count),o(u.list,t),o(s,u)),t.bucket=u,i.list.next===i.list&&h(i)},a.query=function(t){var n=this._values[t];return n?n.count:0},a.error=function(t){var n=this._values[t];return n?n.error:-1},a.values=function(t){return this.collect(t,function(t){return t.value})},a.counts=function(t){return this.collect(t,function(t){return t.count})},a.errors=function(t){return this.collect(t,function(t){return t.error})},a.collect=function(t,n){if(0===t)return[];(null==t||t<0)&&(t=this._size);var e,i,r,s=Array(t),o=this._buckets,h=0;for(e=o.prev;e!==o;e=e.prev)for(i=e.list,r=i.prev;r!==i;r=r.prev)if(s[h++]=n(r),h===t)return s;return s},a.export=function(){var t,n,e,i=this._buckets,r=[];for(t=i.next;t!==i;t=t.next){for(e=[t.count],n=t.list.next;n!==t.list;n=n.next)e.push(n.value,n.error);r.push(e)}return{w:this._w,buckets:r}},n.exports=i},{}],9:[function(t,n,e){function i(t){this._nc=t||c;var n=2*Math.ceil(this._nc);this._totalSum=0,this._last=0,this._weight=a.floats(n),this._mean=a.floats(n),this._min=Number.MAX_VALUE,this._max=-Number.MAX_VALUE,this._mergeWeight=a.floats(n),this._mergeMean=a.floats(n);var e=r(this._nc);this._unmergedSum=0,this._tempLast=0,this._tempWeight=a.floats(e),this._tempMean=a.floats(e),this._order=[]}function r(t){for(var n,e=1,i=t;e<i;)n=e+i>>>1,t>n*Math.log(n)/Math.LN2?e=n+1:i=n;return e}function s(t,n){return t*(Math.asin(2*n-1)+Math.PI/2)/Math.PI}function o(t,n,e,i){for(;e<i;){var r=e+i>>>1;t[r]<n?e=r+1:i=r}return e}function h(t,n,e,i){return e[t]+(e[n]-e[t])*i[t]/(i[t]+i[n])}function u(t,n,e){var i=e-n;return i>_?(t-n)/i:.5}var a=t("./arrays"),_=1e-300,c=100;i.import=function(t){var n=new i(t.centroids),e=0;n._min=t.min,n._max=t.max,n._last=t.mean.length-1;for(var r=0,s=t.mean.length;r<s;++r)n._mean[r]=t.mean[r],e+=n._weight[r]=t.weight[r];return n._totalSum=e,n};var f=i.prototype;f.add=function(t,n){if(null!=t&&t===t){if(n=null==n?1:n,n<=0)throw new Error("Count must be greater than zero.");this._tempLast>=this._tempWeight.length&&this._mergeValues();var e=this._tempLast++;this._tempWeight[e]=n,this._tempMean[e]=t,this._unmergedSum+=n}},f._mergeValues=function(){if(0!==this._unmergedSum){var t,n,e,i,r=this._tempWeight,s=this._tempMean,o=this._tempLast,h=this._weight,u=this._mean,a=0,_=this._order,c=0;for(_.length=o,n=0;n<o;++n)_[n]=n;for(_.sort(function(t,n){return s[t]-s[n]}),this._totalSum>0&&(a=this._last+1),this._last=0,this._totalSum+=this._unmergedSum,this._unmergedSum=0,n=e=i=0;n<o&&e<a;)t=_[n],s[t]<=u[e]?(c+=r[t],i=this._mergeCentroid(c,i,r[t],s[t]),n++):(c+=h[e],i=this._mergeCentroid(c,i,h[e],u[e]),e++);for(;n<o;++n)t=_[n],c+=r[t],i=this._mergeCentroid(c,i,r[t],s[t]);for(;e<a;++e)c+=h[e],i=this._mergeCentroid(c,i,h[e],u[e]);for(this._tempLast=0,this._weight=this._mergeWeight,this._mergeWeight=h,this._mean=this._mergeMean,this._mergeMean=u,u[0]=this._weight[0],n=1,a=this._last,h[0]=0;n<=a;++n)h[n]=0,u[n]=u[n-1]+this._weight[n];this._min=Math.min(this._min,this._mean[0]),this._max=Math.max(this._max,this._mean[a])}},f._mergeCentroid=function(t,n,e,i){var r=this._mergeWeight,o=this._mergeMean,h=this._last,u=s(this._nc,t/this._totalSum);return u-n<=1||0===r[h]?(r[h]+=e,o[h]+=(i-o[h])*e/r[h]):(this._last=++h,o[h]=i,r[h]=e,n=s(this._nc,(t-e)/this._totalSum)),n},f.size=function(){return this._totalSum+this._unmergedSum},f.quantile=function(t){this._mergeValues();var n,e,i,r,s,u=this._totalSum,a=this._last,_=this._mean,c=this._weight,f=this._mergeMean;return e=r=this._min,i=s=this._max,0===u?NaN:t<=0?r:t>=1?s:0===a?_[0]:(t*=u,n=o(f,t,0,a+1),n>0&&(e=h(n-1,n,_,c)),n<a&&(i=h(n,n+1,_,c)),e+(i-e)*(t-(f[n-1]||0))/c[n])},f.cdf=function(t){this._mergeValues();var n,e,i,r,s,a=this._totalSum,_=this._last,c=this._mean,f=this._weight,l=this._mergeMean;return e=r=this._min,i=s=this._max,0===a?NaN:t<r?0:t>s?1:0===_?u(t,r,s):(n=o(c,t,0,_+1),n>0&&(e=h(n-1,n,c,f)),n<_&&(i=h(n,n+1,c,f)),t<e&&(i=e,e=--n?h(n-1,n,c,f):r),((l[n-1]||0)+f[n]*u(t,e,i))/a)},f.union=function(t){var n=i.import(this.export());t._mergeValues();for(var e=0,r=t._last;e<r;++e)n.add(t._mean[e],t._weight[e]);return n},f.export=function(){return this._mergeValues(),{centroids:this._nc,min:this._min,max:this._max,mean:[].slice.call(this._mean,0,this._last+1),weight:[].slice.call(this._weight,0,this._last+1)}},n.exports=i},{"./arrays":1}]},{},[6])(6)});